<app-header></app-header>

<main>
    <!------------------------------ Displayed the Overlay if one or both of the Dropdown Menus are open ------------------------------>
    <div (click)="closeDropdownIfClickOutSide()"
        [ngClass]="{'overlay': dropdownMenuAssignedToIsOpen || dropdownMenuCategoryIsOpen}"></div>
    <!------------------------------ Displayed the Overlay if one or both of the Dropdown Menus are open ------------------------------>

    <app-sidebar></app-sidebar>

    <div class="containerAddTask">
        <h1>Add Task</h1>
        <form (submit)="addTask()" [formGroup]="addTaskForm" id="addTaskForm">
            <div class="containerFormLeftSide">
                <label for="inputTitle" form="addTaskForm">
                    Title
                    <mark>*</mark>
                </label>
                <input [ngClass]="{'errorInputfield': addTaskForm.controls.title.touched && 
                    addTaskForm.controls.title.errors?.['required'] || 
                    addTaskForm.controls.title.errors?.['maxlength']}" formControlName="title" id="inputTitle"
                    type="text" placeholder="Enter a title">

                <p *ngIf="addTaskForm.controls.title.touched && addTaskForm.controls.title.errors?.['required']"
                    class="errorMessage" style="margin-top: -20px;">Title is required</p>

                <p *ngIf="addTaskForm.controls.title.errors?.['maxlength']" class="errorMessage"
                    style="margin-top: -20px;">Title can only 10 maximum characters long</p>

                <label for="textareaDescription" form="addTaskForm">Description</label>
                <textarea [ngClass]="{'errorInputfield': addTaskForm.controls.description.errors?.['maxlength']}"
                    formControlName="description" id="textareaDescription" placeholder="Enter a description"></textarea>

                <p *ngIf="addTaskForm.controls.description.errors?.['maxlength']" class="errorMessage"
                    style="margin-top: -20px;">
                    Description can only 150 maximum characters long
                </p>

                <!------------------------------ Dropdown Menu Assigned to ------------------------------>
                <label form="addTaskForm">
                    Assigned to
                    <mark>*</mark>
                </label>
                <div (click)="openDropdownMenuAssignedTo()"
                    [ngClass]="{'activeDropdownMenu': dropdownMenuAssignedToIsOpen}" class="dropdownMenuBox">
                    <p *ngIf="!dropdownMenuAssignedToIsOpen">Select Contacts to assign</p>
                    <img [ngClass]="{'rotateArrowIconInDropdownMenu': dropdownMenuAssignedToIsOpen}"
                        src="../../../assets/icons/arrow-drop-down-icon.svg">
                </div>

                <!------------------------------ Only Displayed if Contacts selected from Dropdown Menu ------------------------------>
                <div *ngIf="selectedContacts.length > 0" class="containerSelectedContacts">
                    <p matTooltipShowDelay="400" matTooltipPosition="above" matTooltip="{{ contact.name }}"
                        *ngFor="let contact of selectedContacts" [ngStyle]="{'background-color': contact.color}">
                        {{ contact.initialLetter }}
                    </p>
                </div>
                <!------------------------------ Only Displayed if Contacts selected from Dropdown Menu ------------------------------>

                <ul [ngClass]="{'d-none': !dropdownMenuAssignedToIsOpen}" class="dropdownMenuAssignedTo">
                    <li *ngFor="let contact of createNewContactService.contactData | async"
                        (click)="selectContact(contact)"
                        [ngClass]="{'activeSelectedContactInDropdownMenu': contactIsSelected(contact)}">

                        <span [ngStyle]="{'background-color': contact.color}">{{ contact.initialLetter }}</span>
                        <p formControlName="assignedTo" ngDefaultControl>{{ contact.name }}</p>
                        <input [checked]="contactIsSelected(contact)" type="checkbox">
                    </li>
                </ul>
                <!------------------------------ Dropdown Menu Assigned to ------------------------------>

                <p class="thisFieldIsRequiredText">
                    <mark>*</mark>
                    This field is required
                </p>
            </div>

            <hr>

            <div class="containerFormRightSide">
                <label for="inputCalendar" form="addTaskForm">
                    Due Date
                    <mark>*</mark>
                </label>
                <input formControlName="dueDate" id="inputCalendar" type="date">

                <label form="addTaskForm">
                    Prio
                    <mark>*</mark>
                </label>
                <!------------------------------ Prio Buttons ------------------------------>
                <div class="containerPrioBtns">
                    <button formControlName="prio" ngDefaultControl
                        [ngClass]="{'btnUrgentPrio': activePrioBtn == 'urgent'}" (click)="selectPrio('urgent')"
                        type="button">
                        Urgent
                        <img src="../../../assets/icons/priority-urgent-icon.svg">
                    </button>

                    <button formControlName="prio" ngDefaultControl
                        [ngClass]="{'btnMediumPrio': activePrioBtn == 'medium'}" (click)="selectPrio('medium')"
                        type="button">
                        Medium
                        <img src="../../../assets/icons/priority-medium-icon.svg">
                    </button>

                    <button formControlName="prio" ngDefaultControl [ngClass]="{'btnLowPrio': activePrioBtn == 'low'}"
                        (click)="selectPrio('low')" type="button">
                        Low
                        <img src="../../../assets/icons/priority-low-icon.svg">
                    </button>
                </div>
                <!------------------------------ Prio Buttons ------------------------------>

                <!------------------------------ Dropdown Menu Category ------------------------------>
                <label form="addTaskForm">
                    Category
                    <mark>*</mark>
                </label>
                <div (click)="openDropdownMenuCategory()" [ngClass]="{'activeDropdownMenu': dropdownMenuCategoryIsOpen}"
                    class="dropdownMenuBox">
                    <p>{{ selectedCategory ? selectedCategory : 'Select task category' }}</p>
                    <img [ngClass]="{'rotateArrowIconInDropdownMenu': dropdownMenuCategoryIsOpen}"
                        src="../../../assets/icons/arrow-drop-down-icon.svg">
                </div>

                <ul *ngIf="dropdownMenuCategoryIsOpen" class="dropdownMenuCategory">
                    <li (click)="selectCategory('test')">
                        <p formControlName="category" ngDefaultControl>test</p>
                    </li>
                </ul>
                <!------------------------------ Dropdown Menu Category ------------------------------>

                <div class="containerBtnsClearFormAndAddTask">
                    <button (click)="clearForm()" class="btnClearForm" type="reset">
                        Clear
                        <img src="../../../assets/icons/close-icon.svg">
                    </button>
                    <button
                        [disabled]="addTaskForm.invalid || selectedContact == '' || activePrioBtn == ''  || selectedCategory == '' "
                        [ngClass]="{'btnDisabled': addTaskForm.invalid || selectedContact == '' || activePrioBtn == '' || selectedCategory == ''}"
                        class="btnCreateTask" type="submit">
                        Create Task
                        <img src="../../../assets/icons/check-icon-white.svg">
                    </button>
                </div>
            </div>
        </form>
    </div>
</main>